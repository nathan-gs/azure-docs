---
title: Creating surrogate keys using IDENTITY | Microsoft Docs
description: Learn how to use IDENTITY to create a surrogate key on your tables.
services: sql-data-warehouse
documentationcenter: NA
author: jrowlandjones
manager: jhubbard
editor: ''

ms.assetid: faa1034d-314c-4f9d-af81-f5a9aedf33e4
ms.service: sql-data-warehouse
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-services
ms.date: 06/13/2017
ms.author: jrj;barbkess

---
# Creating surrogate keys using IDENTITY
> [!div class="op_single_selector"]
> * [Overview][Overview]
> * [Data Types][Data Types]
> * [Distribute][Distribute]
> * [Index][Index]
> * [Partition][Partition]
> * [Statistics][Statistics]
> * [Temporary][Temporary]
> * [Identity][Identity]
> 
> 

Many data modelers like to create surrogate keys on their tables when designing data warehouse models. You can use the IDENTITY property to achieve this goal simply and effectively without impacting load performance. 

## Getting started with Identity
You can define a table as having the IDENTITY property when you first create the table using syntax that is similar to the following statement:

```sql
CREATE TABLE dbo.T1
(	C1 INT IDENTITY(1,1) NOT NULL
,	C2 INT NULL
)
WITH
(   DISTRIBUTION = HASH(C2)
,   CLUSTERED COLUMNSTORE INDEX
)
;
```

You can then use `INSERT..SELECT` to populate the table.

## Behavior
The IDENTITY property is designed to scale out across all the distributions in the data warehouse without impacting load performance. Therefore the implementation of IDENTITY is oriented toward achieving these goals. This section highlights the nuances of the implementation to help you understand them more fully.  

### Allocation of values
The IDENTITY property does not guarantee the order in which the surrogate values are allocated; reflecting the behavior of SQL Server and SQL DB. However, in SQL Data Warehouse, the absence of a guarantee is more pronounced. 

Look at the following example as an illustration:

```sql
CREATE TABLE dbo.T1
(	C1 INT IDENTITY(1,1)	NOT NULL
,	C2 VARCHAR(30)				NULL
)
WITH
(   DISTRIBUTION = HASH(C2)
,   CLUSTERED COLUMNSTORE INDEX
)
;

INSERT INTO dbo.T1
VALUES (NULL);

INSERT INTO dbo.T1
VALUES (NULL);

SELECT *
FROM dbo.T1;

DBCC PDW_SHOWSPACEUSED('dbo.T1');
```

It is important to note that two rows have landed in distribution 1. The first row has the surrogate value of 1 in column `C1` and the second row has the surrogate value of 61. Both these values were generated by the IDENTITY property. However, the allocation of the values is not contiguous. This behavior is by design.

### Skewed data 
The range of values for the data type are spread evenly across the distributions. If a distributed table suffers from data skew, then the range of values available to the datatype can be exhausted prematurely. For example, if all the data ends up in a single distribution then effectively the table only has access to 1/60th of the values of the data type. For this reason, the IDENTITY property is limited to `INT` and `BIGINT` data types only.

### SELECT..INTO
When an existing identity column is selected into a new table, the new column inherits the IDENTITY property, unless one of the following conditions is true:
- The SELECT statement contains a join
- Multiple SELECT statements are joined by using UNION
- The identity column is listed more than one time in the select list
- The identity column is part of an expression
	
If any one of these conditions is true, the column is created NOT NULL instead of inheriting the IDENTITY property

### CREATE TABLE AS SELECT (CTAS)
CTAS follows the same SQL Server behavior that has been documented for SELECT..INTO. However, you cannot specify an IDENTITY property in column definition of the `CREATE TABLE` part of the statement itself. You also cannot use the IDENTITY function in the `SELECT` part of the CTAS either. To populate a table, you would need to use `CREATE TABLE` to define the table followed by `INSERT..SELECT` to populate it.

## Explicit insertion of values into an IDENTITY column 
SQL Data Warehouse supports `SET IDENTITY_INSERT <your table> ON|OFF` syntax. You can use this syntax to explicitly insert values into the IDENTITY column.

Many data modelers like to use pre-defined negative values for certain rows in their dimensions. A good example is the -1 or "unknown member" row. 

The next script shows how to explicitly add this row using SET IDENTITY_INSERT:

```sql
SET IDENTITY_INSERT dbo.T1 ON;

INSERT INTO dbo.T1
(   C1
,   C2
)
VALUES (-1,'UNKNOWN')
;

SET IDENTITY_INSERT dbo.T1 OFF;

SELECT 	*
FROM	dbo.T1
;
```    

## Loading data into a table with IDENTITY

The presence of the IDENTITY property does have some implications to your data loading code. This next section highlights some basic patterns for loading data into tables using IDENTITY. 

### Loading with PolyBase
To load data into a table and generate a surrogate key using IDENTITY, you must first create the table and then use INSERT..SELECT or INSERT..VALUES to perform the load.

The following example highlights the basic pattern:
 
```sql
--CREATE TABLE with IDENTITY
CREATE TABLE dbo.T1
(	C1 INT IDENTITY(1,1)
,	C2 VARCHAR(30)
)
WITH
(   DISTRIBUTION = HASH(C2)
,   CLUSTERED COLUMNSTORE INDEX
)
;

--Use INSERT..SELECT to populate the table from an external table
INSERT INTO dbo.T1
(C2)
SELECT 	C2
FROM	ext.T1
;

SELECT 	*
FROM 	dbo.T1
;

DBCC PDW_SHOWSPACEUSED('dbo.T1');
```

> [!NOTE] 
> It is not possible to use `CREATE TABLE AS SELECT` currently when loading into a table with an IDENTITY column
> 

For more information on data loading with bcp, see the following articles:

- [Load with PolyBase][]
- [PolyBase best practices][]

### Loading with bcp
Bulk Copy Program (bcp) is a command-line utility that you can use for loading data into SQL Data Warehouse. One of its parameters (-E) controls the behavior of bcp when loading into a table with an IDENTITY column. 

When -E is specified the values held in the input file for the column with IDENTITY are retained. If -E is *not* specified then the values in this column are ignored. If the identity column is not included, then the data is loaded as normal. The values are generated according to the increment and seed policy of the property.

For more information on data loading with bcp, see the following articles:

- [Load with bcp][]
- [bcp in MSDN][]

## Catalog Views
SQL Data Warehouse supports the `sys.identity_columns` catalog view. This view can be used to identify a column as having the IDENTITY property.

An example of how to integrate `sys.identity_columns` with other system catalog views to help you better understand the database schema.

```sql
SELECT  sm.name
,       tb.name
,       co.name
,       CASE WHEN ic.column_id IS NOT NULL
             THEN 1
        ELSE 0
        END AS is_identity 
FROM        sys.schemas AS sm
JOIN        sys.tables  AS tb           ON  sm.schema_id = tb.schema_id
JOIN        sys.columns AS co           ON  tb.object_id = co.object_id
LEFT JOIN   sys.identity_columns AS ic  ON  co.object_id = ic.object_id
                                        AND co.column_id = ic.column_id
WHERE   sm.name = 'dbo'
AND     tb.name = 'T1'
;
```

## Limitations
The IDENTITY property cannot be used in the following scenarios:
- where the column data type is not INT or BIGINT
- where the column is also the distribution key
- where the table is an external table 

The following related functions are not supported in SQL Data Warehouse:

- [IDENTITY()][]
- [@@IDENTITY][]
- [SCOPE_IDENTITY][]
- [IDENT_CURRENT][]
- [IDENT_INCR][]
- [IDENT_SEED][]
- [DBCC CHECK_IDENT()][]

## Tasks

This section provides some sample code for performing common tasks when working with IDENTITY columns.

> [!NOTE] 
> Column C1 is the IDENTITY in all the following tasks.
> 
 
### Find the highest allocated value for a table
Use the `MAX()` function to determine the highest value allocated for a distributed table:

```sql
SELECT 	MAX(C1)
FROM	dbo.T1
``` 

### Find the seed and increment for the identity property
You can use the catalog views to discover the identity increment and seed configuration values for a table using the following query: 

```sql
SELECT  sm.name
,       tb.name
,       co.name
,       ic.seed_value
,       ic.increment_value 
FROM        sys.schemas AS sm
JOIN        sys.tables  AS tb           ON  sm.schema_id = tb.schema_id
JOIN        sys.columns AS co           ON  tb.object_id = co.object_id
JOIN        sys.identity_columns AS ic  ON  co.object_id = ic.object_id
                                        AND co.column_id = ic.column_id
WHERE   sm.name = 'dbo'
AND     tb.name = 'T1'
;
```

## Next steps

To learn more about developing tables, see the articles on [Table Overview][Overview], [Table Data Types][Data Types], [Distributing a Table][Distribute], [Indexing a Table][Index],  [Partitioning a Table][Partition] and [Temporary Tables][Temporary].  For more about best practices, see [SQL Data Warehouse Best Practices][SQL Data Warehouse Best Practices].  

<!--Image references-->

<!--Article references-->
[Overview]: ./sql-data-warehouse-tables-overview.md
[Data Types]: ./sql-data-warehouse-tables-data-types.md
[Distribute]: ./sql-data-warehouse-tables-distribute.md
[Index]: ./sql-data-warehouse-tables-index.md
[Partition]: ./sql-data-warehouse-tables-partition.md
[Statistics]: ./sql-data-warehouse-tables-statistics.md
[Temporary]: ./sql-data-warehouse-tables-temporary.md
[Identity]: ./sql-data-warehouse-tables-identity.md
[SQL Data Warehouse Best Practices]: ./sql-data-warehouse-best-practices.md

[Load with bcp]: https://docs.microsoft.com/azure/sql-data-warehouse/sql-data-warehouse-load-with-bcp/
[Load with PolyBase]: https://docs.microsoft.com/azure/sql-data-warehouse/sql-data-warehouse-load-from-azure-blob-storage-with-polybase/
[PolyBase best practices]: https://docs.microsoft.com/azure/sql-data-warehouse/sql-data-warehouse-load-polybase-guide/


<!--MSDN references-->
[Identity property]: https://msdn.microsoft.com/library/ms186775.aspx
[sys.identity_columns]: https://msdn.microsoft.com/library/ms187334.aspx
[IDENTITY()]: https://msdn.microsoft.com/library/ms189838.aspx
[@@IDENTITY]: https://msdn.microsoft.com/library/ms187342.aspx
[SCOPE_IDENTITY]: https://msdn.microsoft.com/library/ms190315.aspx
[IDENT_CURRENT]: https://msdn.microsoft.com/library/ms175098.aspx
[IDENT_INCR]: https://msdn.microsoft.com/library/ms189795.aspx
[IDENT_SEED]: https://msdn.microsoft.com/library/ms189834.aspx
[DBCC CHECK_IDENT()]: https://msdn.microsoft.com/library/ms176057.aspx

[bcp in MSDN]: https://msdn.microsoft.com/library/ms162802.aspx
  

<!--Other Web references-->  
